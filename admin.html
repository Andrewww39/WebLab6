<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>СТО Копатич - АДМІН</title>
    <link rel="stylesheet" href="style_grid.css">
    <style>
        .admin-form {
            text-align: left;
            width: 90%;
            margin: 0 auto;
            max-height: 400px;
            overflow-y: auto;
        }
        .form-group {
            background: #f9f9f9;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .form-group label { font-weight: bold; font-size: 12px; }
        .form-group input { width: 100%; margin-bottom: 5px; box-sizing: border-box; }
        .btn-add { background: #28a745; color: white; border: none; padding: 5px 10px; cursor: pointer; }
        .btn-save { background: #007bff; color: white; border: none; padding: 10px 20px; cursor: pointer; font-size: 16px; margin-top: 10px;}
        .btn-del { background: #dc3545; color: white; border: none; cursor: pointer; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <div class="block header"> <h1>СТО Копатич (Admin Panel)</h1> <p>Режим редагування</p></div>

    <div class="block left"><p>Тут ви можете налаштувати меню для клієнтської частини сайту.</p></div>
    <div class="block top"><p>Панель керування контентом</p></div>

    <div class="block center">
        <div class="admin-form">
            <h3>Конструктор Меню</h3>
            <p style="font-size: 12px; color: #666;">
                Для підпунктів використовуйте формат: <b>Назва|Посилання</b> (через кому).<br>
                Наприклад: <i>Історія|history.html, Команда|team.html</i>
            </p>

            <div id="menu-items-container"></div>

            <button onclick="addMenuItem()" class="btn-add">+ Додати пункт</button>
            <br>
            <button onclick="saveMenuToServer()" class="btn-save">ЗБЕРЕГТИ НА СЕРВЕР</button>
            <p id="status" style="color: green; font-weight: bold;"></p>
        </div>
    </div>

    <div class="block right"><img src="images/logo.png" alt="logo" class="img_logo"></div>
    <div class="block bottom"><p>Зміни вступають в силу через 3 секунди</p></div>
    <div class="block footer"><h2>Адмін</h2></div>
</div>

<script>
    function addMenuItem() {
        const container = document.getElementById('menu-items-container');
        const div = document.createElement('div');
        div.className = 'form-group';
        div.innerHTML = `
            <label>Назва пункту:</label>
            <input type="text" class="menu-title" placeholder="Напр: Послуги">
            
            <label>Посилання (головне):</label>
            <input type="text" class="menu-link" placeholder="Напр: page3.html">
            
            <label>Підпункти (Назва|Посилання):</label>
            <input type="text" class="submenu-items" placeholder="Ремонт|repair.html, Фарбування|paint.html">
            
            <button class="btn-del" onclick="this.parentElement.remove()">Видалити</button>
        `;
        container.appendChild(div);
    }

    async function saveMenuToServer() {
        const items = document.querySelectorAll('.form-group');
        let menuData = [];

        items.forEach(item => {
            let title = item.querySelector('.menu-title').value;
            let link = item.querySelector('.menu-link').value;
            let submenuRaw = item.querySelector('.submenu-items').value;
            
            let submenu = [];
            if (submenuRaw) {
                let parts = submenuRaw.split(',');
                parts.forEach(part => {
                    let pair = part.split('|');
                    let subTitle = pair[0].trim();
                    let subLink = pair[1] ? pair[1].trim() : '#';
                    submenu.push({ title: subTitle, link: subLink });
                });
            }

            if(title) {
                menuData.push({ title, link, submenu });
            }
        });

        try {
            let response = await fetch('server.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(menuData)
            });
            let result = await response.json();
            document.getElementById('status').innerText = result.message;
        } catch (e) {
            alert("Помилка! Запустіть через XAMPP (localhost).");
        }
    }
    
    addMenuItem();
</script>

</body>
</html>